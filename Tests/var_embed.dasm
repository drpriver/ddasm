# Test embed directive in variable initializers
dlimport Libc
    path "libc.so.6"
    function printf 1 1 varargs
end

var data 1 embed "Tests/embed8.bin" 0 8 end

function main 0
    # Read each byte and print it
    move r1 var data
    read1 r2 r1
    push r2
    add r1 r1 1
    read1 r2 r1
    push r2
    add r1 r1 1
    read1 r2 r1
    push r2
    add r1 r1 1
    read1 r2 r1
    push r2
    add r1 r1 1
    read1 r2 r1
    push r2
    add r1 r1 1
    read1 r2 r1
    push r2
    add r1 r1 1
    read1 r2 r1
    push r2
    add r1 r1 1
    read1 r2 r1
    push r2
    move r0 "%c%c%c%c%c%c%c%c\n"
    call function Libc.printf 9
    sub rsp rsp 64
    move r15 0
    ret
end

import misc
function start 0
    call function main 0
    move rarg1 rout1
    call function misc.exit 1
    ret
end
